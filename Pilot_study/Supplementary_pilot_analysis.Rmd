---
title: "Supplementary_pilot_analysis"
author: "valeriia beliaeva"
date: "3/18/2021"
output:
  pdf_document: default
  html_document: default
---

```{r setup, warning=FALSE, message=FALSE}

.libPaths('C:/Users/vbeliaev/Documents/r_packages')

knitr::opts_chunk$set(echo = TRUE)

rm(list = ls())

library(ggsignif)
library(ggplot2)
library(gridExtra)
library(lme4)
library(plyr)
library(dplyr)
library(boot)
library(data.table)

# loading preprocessed data
tab1 = as.data.table(read.csv("Data_collected_together_preprocessed.csv"))
tab1$Size_diff.z = scale(tab1$Size_diff)
tab1$Taste_diff.z = scale(tab1$Taste_diff)
tab1$RT.z = scale(tab1$RT)

dataVal = tab1[Cue_Taste1_Size2 == 1]
dataPer = tab1[Cue_Taste1_Size2 == 2]
ns = length(unique(tab1$Participant))

```


In this script you will find additional analysis for the pilot study. 
Main analysis in contained in the script 'pilot_data_analysis'. 

Here, we want to demonstrate that the behavioral task, which includes rating and choice stages, works properly. For that we need to see that pictures selected in the choice task are modulated by the difference between two items that are presented on the screen. 

For example, in the rating task participant rated taste of banana for 0.8 and twix for 0.9. In the choice task these two pictures are presented in the same trial: banana in the upper part of the screen and twix in the lower part of the screen. We calculate the difference between them up - down picture = -0.1. Then another trial with strawberry (up) and bounty (down), rated before as 0.7 and 0.85 with difference = -0.15. Probability to choose top picture in these two trials should be lower than chance level and probability depends in this case on the difference, it is even lower when the difference between 2 pictures is lower (-0.15). This difference is splitted in categories: e.g., category 1 (difference = -0.2 : -0.15, category 2 = -0.15:-0.1)

After that, we performed analysis for reaction time in the choice task, however, we did not find there any significant effect of TI stimulation. 

## Verifing the behavioral task 

```{r plot behav task, warning=FALSE, message=FALSE}

# plot taste
data1 = ddply(dataVal, .(Participant,Taste_diff.ntile), summarise, acc = mean(Choice01))
data2 = ddply(data1, .(Taste_diff.ntile), summarise, acc2 = mean(acc), se=sd(acc)/sqrt(ns))
data2$cued = "Taste"
colnames(data2)[1] = "diff"

data1 = ddply(dataVal, .(Participant,Size_diff.ntile), summarise, acc = mean(Choice01))
data3 = ddply(data1, .(Size_diff.ntile), summarise, acc2 = mean(acc), se=sd(acc)/sqrt(ns))
data3$cued = "Size"
colnames(data3)[1] = "diff"

data4 = rbind(data2,data3)

colors =c('#AA0000','#0044AA')
limits = aes(ymax = acc2+se, ymin=acc2-se, colour=cued, group=cued)

p1.val = ggplot(data4, aes(diff, acc2, group=cued)) +
  geom_line(aes(colour=cued), size=2) +
  geom_errorbar(limits, width=0.25, size=1) +
  geom_point(aes(shape=cued, colour=cued), size=4) +
  scale_colour_manual(values=colors) +
  theme_classic() +
  ylab("Prob. choose top") + xlab("Category difference") + 
  theme(axis.title=element_text(size=17)) + theme(axis.text=element_text(size=17)) +
  coord_cartesian(ylim = c(0, 1)) +
  ggtitle("Taste trials") + 
    theme(legend.title = element_blank()) 


# plot size
data1 = ddply(dataPer, .(Participant,Taste_diff.ntile), summarise, acc = mean(Choice01))
data2 = ddply(data1, .(Taste_diff.ntile), summarise, acc2 = mean(acc), se=sd(acc)/sqrt(ns))
data2$cued = "Taste"
colnames(data2)[1] = "diff"

data1 = ddply(dataPer, .(Participant,Size_diff.ntile), summarise, acc = mean(Choice01))
data3 = ddply(data1, .(Size_diff.ntile), summarise, acc2 = mean(acc), se=sd(acc)/sqrt(ns))
data3$cued = "Size"
colnames(data3)[1] = "diff"

data4 = rbind(data2,data3)

colors =c('#AA0000','#0044AA')
limits = aes(ymax = acc2+se, ymin=acc2-se, colour=cued, group=cued)

p1.per = ggplot(data4, aes(diff, acc2, group=cued)) +
  geom_line(aes(colour=cued), size=2) +
  geom_errorbar(limits, width=0.25, size=1) +
  geom_point(aes(shape=cued, colour=cued), size=4) +
  scale_colour_manual(values=colors) +
  theme_classic() +
  ylab("Prob. choose top") + xlab("Category difference") + 
  theme(axis.title=element_text(size=17)) + theme(axis.text=element_text(size=17)) +
  coord_cartesian(ylim = c(0, 1)) +
  ggtitle("Size trials") + 
    theme(legend.title = element_blank())


grid.arrange(p1.val, p1.per, ncol=2, widths=c(1,1))

```

From this plot we can see that the task is working as intended. In taste trials participants are choosing more frequently top picture, if it was rated higher than bottom picture for taste during the rating task (categories from 5 to 8). Oppositely, difference in size between two pictures affects less participants choices, when they are asked to compare images for taste. 

Now these dependences (between probability to choose top picture and differences in taste or size between two food items) were explored with a model. 

### Effect of taste and size differences in taste trials 

```{r behav task model taste, warning=FALSE, message=FALSE}

m1.val = glmer(Choice01 ~ Size_diff.z + Taste_diff.z + (1+Size_diff.z + Taste_diff.z|Participant), data=dataVal, family=binomial(link = "logit"))

summary(m1.val)

```

### Effect of taste and size differences in size trials 

```{r behav task model size, warning=FALSE, message=FALSE}

m1.per = glmer(Choice01 ~ Size_diff.z + Taste_diff.z + (1+Size_diff.z + Taste_diff.z|Participant), data=dataPer, family=binomial(link = "logit"))

summary(m1.per)

```

Models demonstrate that there are intrusions and size can affect participants choices even when they are asked to compare food items for taste. However, this effect is smaller for size than for taste in taste trials and in the same way for size trials. 

## Analysis of RT 

### Immidiate effects of TI on taste trials 

```{r immidiate TI taste, warning=FALSE, message=FALSE}

idx = which(dataVal$Trial_Nr<113)            #Table: first 112 trials, when TI is on
dataVal2 = dataVal[idx,]

m1.val.stim1.abs = lmer(RT.z ~ Taste_diff.abs*Stim + (1+Taste_diff.abs*Stim|Participant), data=dataVal2)

summary(m1.val.stim1.abs)

```

### After effects of TI on taste trials 

```{r after effects TI taste, warning=FALSE, message=FALSE}

idx = which(dataVal$Trial_Nr>=113)            #Table: last 64 trials, when TI is off
dataVal2 = dataVal[idx,]

m1.val.stim2.abs = lmer(RT.z ~ Taste_diff.abs*Stim + (1+Taste_diff.abs*Stim|Participant), data=dataVal2)

summary(m1.val.stim2.abs)

```

### Immidiate effects of TI on size trials 

```{r immidiate TI size, warning=FALSE, message=FALSE}

idx = which(dataPer$Trial_Nr<113)            #Table: first 112 trials, when TI is on
dataPer2 = dataPer[idx,]

m1.per.stim1.abs = lmer(RT.z ~ Size_diff.abs*Stim + (1+Size_diff.abs*Stim|Participant), data=dataPer2)

summary(m1.per.stim1.abs)

```

### After effects of TI on size trials 

```{r after effects TI size, warning=FALSE, message=FALSE}

idx = which(dataPer$Trial_Nr>=113)            #Table: last 64 trials, when TI is off
dataPer2 = dataPer[idx,]

m1.per.stim2.abs = lmer(RT.z ~ Size_diff.abs*Stim + (1+Size_diff.abs*Stim|Participant), data=dataPer2)

summary(m1.per.stim2.abs)

```

